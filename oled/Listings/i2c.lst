C51 COMPILER V9.60.0.0   I2C                                                               05/08/2021 23:11:38 PAGE 1   


C51 COMPILER V9.60.0.0, COMPILATION OF MODULE I2C
OBJECT MODULE PLACED IN .\Objects\i2c.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.exe i2c.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listings\i2c.l
                    -st) TABS(2) OBJECT(.\Objects\i2c.obj)

line level    source

   1          #include <REGX51.H>
   2          #include "i2c.h"
   3          
   4          char sda_data = 0;
   5          int sda_bit = 0;
   6          int sda_begin = 0;
   7          int sda_end = 0;
   8          int sda_strt = 0;
   9          int sda_ack = 0;
  10          
  11          
  12          void clock_gen(int rate)
  13          {
  14   1        TMOD = 0x20;
  15   1        TL1 = 256-(28800/rate);
  16   1        TH1 = TL1;
  17   1        EA = 1;
  18   1        ET1 = 1;
  19   1        TR1 = 1;
  20   1      }
  21          
  22          void sda_write(char c)
  23          {
  24   1        sda_begin = 1;
  25   1        sda_data = c;
  26   1        while(sda_begin);
  27   1      }
  28          
  29          void sda_start()
  30          {
  31   1        sda_strt = 1;
  32   1      }
  33          
  34          void sda_stop()
  35          {
  36   1        sda_end = 1;
  37   1      }
  38          
  39          void intr_ser(void) interrupt 3
  40          {
  41   1         
  42   1         if((scl == 0) && (sda_begin == 1))
  43   1           {
  44   2            sda = ((sda_data >> sda_bit++) & 0x01);
  45   2            if(sda_bit >= 8)
  46   2              {
  47   3                sda_begin = 0;
  48   3                sda_ack = 1;
  49   3                sda_bit = 0;
  50   3              }
  51   2            } 
  52   1           
  53   1      
  54   1        
C51 COMPILER V9.60.0.0   I2C                                                               05/08/2021 23:11:38 PAGE 2   

  55   1         scl =(~scl);  // clock
  56   1               if((sda_ack == 1) && (scl == 0))  // acknowledge
  57   1          {
  58   2           sda = 1;
  59   2           sda_ack = 0;
  60   2          }
  61   1         
  62   1         if((scl == 1) && (sda_strt == 1))  // send start condition
  63   1          {  
  64   2            sda = 0;
  65   2            sda_strt = 0;
  66   2          }
  67   1          
  68   1         if ((scl == 1) && (sda_end == 1))  // send stop condition
  69   1           {
  70   2             sda = 1;
  71   2             sda_end = 0;
  72   2           }
  73   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    197    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     11    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
