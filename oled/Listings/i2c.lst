C51 COMPILER V9.60.0.0   I2C                                                               05/09/2021 18:33:05 PAGE 1   


C51 COMPILER V9.60.0.0, COMPILATION OF MODULE I2C
OBJECT MODULE PLACED IN .\Objects\i2c.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.exe i2c.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listings\i2c.l
                    -st) TABS(2) OBJECT(.\Objects\i2c.obj)

line level    source

   1          #include <REGX51.H>
   2          #include "i2c.h"
   3          
   4          char sda_data = 0;
   5          int sda_bit = 0;
   6          int sda_begin = 0;
   7          int sda_end = 0;
   8          int sda_strt = 0;
   9          int sda_ack = 0;
  10          int sda_ = 0;
  11          
  12          
  13          void clock_gen(int rate)
  14          {
  15   1        TMOD = 0x20;
  16   1        TL1 = 256-(28800/rate);
  17   1        TH1 = TL1;
  18   1        EA = 1;
  19   1        ET1 = 1;
  20   1        TR1 = 1;
  21   1      }
  22          
  23          void sda_write(char c)
  24          {
  25   1        sda_data = c;
  26   1        sda_begin = 1;
  27   1        while(sda_begin);
  28   1      }
  29          
  30          void sda_start()
  31          {
  32   1        sda_strt = 1;
  33   1      }
  34          
  35          void sda_stop()
  36          {
  37   1        sda_end = 1;
  38   1      }
  39          
  40          void intr_ser(void) interrupt 3
  41          {
  42   1         
  43   1         if((scl == 0) && (sda_begin == 1) && (sda_ == 1))
  44   1           {
  45   2            sda = ((sda_data >> sda_bit++) & 0x01);
  46   2            if(sda_bit >= 8)
  47   2              {
  48   3                sda_begin = 0;
  49   3                sda_ack = 1;
  50   3                //sda = 1;      //ack bit
  51   3                sda_bit = 0;    //what i need is GO TO THE NEXT BYTE FROM HERE !!!!!
  52   3                goto here;
  53   3              }
  54   2            } 
C51 COMPILER V9.60.0.0   I2C                                                               05/09/2021 18:33:05 PAGE 2   

  55   1           
  56   1          scl =(~scl);  // clock
  57   1            
  58   1          if((sda_ack == 1) && (scl == 0))  // acknowledge
  59   1          {
  60   2            sda = 1;
  61   2            sda_ack = 0;
  62   2          }
  63   1          here:
  64   1         if((scl == 1) && (sda_strt == 1))  // send start condition
  65   1          {  
  66   2            sda = 0;
  67   2            sda_strt = 0;
  68   2            sda_ = 1;
  69   2          }
  70   1      
  71   1         if ((scl == 1) && (sda_end == 1))  // send stop condition
  72   1           {
  73   2             sda = 1;
  74   2             sda_end = 0;
  75   2             sda_= 0;
  76   2           }
  77   1           
  78   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    216    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     13    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
